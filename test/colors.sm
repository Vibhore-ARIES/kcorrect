if($?absmmin == 0) {define absmmin -22.}
if($?absmmax == 0) {define absmmax -21.5}

data testsp.K.maggies.z0.1.dat
read <urec 1 grec 2 rrec 3 irec 4 zrec 5>
data testsp.K.dat
read <zz 1 >

set xx = 2.*2.99792e+3*(1.-1./sqrt(1.+zz))
set dm = 25.+5.*lg(xx*(1.+zz))

set rec0 = -2.5*lg(urec)/lg(10.)
set rec1 = -2.5*lg(grec)/lg(10.)
set rec2 = -2.5*lg(rrec)/lg(10.)
set rec3 = -2.5*lg(irec)/lg(10.)
set rec4 = -2.5*lg(zrec)/lg(10.)

set i = 0, dimen(rec0)
set indx = i if (rec2-dm>$absmmin && rec2-dm<$absmmax)
set rec0 = rec0[indx]
set rec1 = rec1[indx]
set rec2 = rec2[indx]
set rec3 = rec3[indx]
set rec4 = rec4[indx]
set zz = zz[indx]

set bands = <'u' 'g' 'r' 'i' 'z'>
set bcolors = <0 1 2 2>
set rcolors = <2 2 3 4>
set hilims = <4. 1.3 0.5 1.>
set lolims = <0. 0.3 0. 0.1>

macro colorloop {
   define bcolor (bcolors[i])
   define rcolor (rcolors[i])
   define hilim (hilims[i])
   define lolim (lolims[i])
   define ip1 (i+1)
   set color = rec$bcolor-rec$rcolor
   ptype 1 1 
   hvfracsep $ip1 4 1.0 1 1 1.
   limits 0. 0.5 $lolim $hilim
   putbox 0 2 0 0
   points zz color
}

for i=0 i<4 i=i+1 colorloop
putbox 1 2 0 0
xlab z
